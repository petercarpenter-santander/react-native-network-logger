{"version":3,"sources":["NetworkLogger.tsx"],"names":["sortRequests","requests","sort","reverse","NetworkLogger","theme","setRequests","logger","getRequests","request","setRequest","showDetails","_setShowDetails","setShowDetails","shouldShow","undefined","setCallback","updatedRequests","enableXHRInterception","onBack","backHandler","BackHandler","addEventListener","remove","showMore","Alert","alert","text","onPress","clearRequests","style","styles","visible","hidden","item","StyleSheet","create","flex"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useCallback } from 'react';\nimport { Alert, View, StyleSheet, BackHandler } from 'react-native';\nimport logger from '../loggerSingleton';\nimport NetworkRequestInfo from '../NetworkRequestInfo';\nimport { ThemeContext, ThemeName } from '../theme';\nimport RequestList from './RequestList';\nimport RequestDetails from './RequestDetails';\nimport { setBackHandler } from '../backHandler';\n\ninterface Props {\n  theme?: ThemeName;\n  sort?: 'asc' | 'desc';\n}\n\nconst sortRequests = (requests: NetworkRequestInfo[], sort: 'asc' | 'desc') => {\n  if (sort === 'asc') {\n    return requests.reverse();\n  }\n  return [...requests];\n};\n\nconst NetworkLogger: React.FC<Props> = ({ theme = 'light', sort = 'desc' }) => {\n  const [requests, setRequests] = useState(\n    sortRequests(logger.getRequests(), sort)\n  );\n  const [request, setRequest] = useState<NetworkRequestInfo>();\n  const [showDetails, _setShowDetails] = useState(false);\n\n  const setShowDetails = useCallback((shouldShow: boolean) => {\n    _setShowDetails(shouldShow);\n\n    if (shouldShow) {\n      setBackHandler(() => setShowDetails(false));\n    } else {\n      setBackHandler(undefined);\n    }\n  }, []);\n\n  useEffect(() => {\n    logger.setCallback((updatedRequests: NetworkRequestInfo[]) => {\n      setRequests(sortRequests(updatedRequests, sort));\n    });\n\n    logger.enableXHRInterception();\n\n    return () => {\n      // no-op if component is unmounted\n      logger.setCallback(() => {});\n    };\n  }, [sort]);\n\n  useEffect(() => {\n    const onBack = () => {\n      if (showDetails) {\n        setShowDetails(false);\n        return true;\n      }\n\n      // Let default back handler take over\n      return false;\n    };\n\n    const backHandler = BackHandler.addEventListener(\n      'hardwareBackPress',\n      onBack\n    );\n\n    return () => backHandler.remove();\n  }, [showDetails, setShowDetails]);\n\n  const showMore = () => {\n    Alert.alert('More Options', undefined, [\n      {\n        text: 'Clear Logs',\n        onPress: () => logger.clearRequests(),\n        style: 'destructive',\n      },\n      { text: 'Cancel', style: 'cancel' },\n    ]);\n  };\n\n  return (\n    <ThemeContext.Provider value={theme}>\n      <View style={styles.visible}>\n        {showDetails && !!request && (\n          <View style={styles.visible}>\n            <RequestDetails\n              onClose={() => setShowDetails(false)}\n              request={request}\n            />\n          </View>\n        )}\n        <View style={showDetails && !!request ? styles.hidden : styles.visible}>\n          <RequestList\n            requests={requests}\n            onShowMore={showMore}\n            showDetails={showDetails && !!request}\n            onPressItem={(item) => {\n              setRequest(item);\n              setShowDetails(true);\n            }}\n          />\n        </View>\n      </View>\n    </ThemeContext.Provider>\n  );\n};\n\nconst styles = StyleSheet.create({\n  visible: {\n    flex: 1,\n  },\n  hidden: {\n    flex: 0,\n  },\n});\n\nexport default NetworkLogger;\n"]}