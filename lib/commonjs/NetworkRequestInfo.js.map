{"version":3,"sources":["NetworkRequestInfo.ts"],"names":["NetworkRequestInfo","constructor","id","type","method","url","undefined","duration","endTime","startTime","curlRequest","headersPart","requestHeaders","Object","entries","map","key","value","escapeQuotes","join","body","dataSent","methodPart","toUpperCase","bodyPart","parts","filter","Boolean","replace","stringifyFormat","data","_parts","length","JSON","stringify","parse","e","getRequestBody","parseResponseBlob","blobReader","BlobFileReader","readAsText","response","Promise","resolve","reject","handleError","error","addEventListener","result","getResponseBody","responseType"],"mappings":"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","sourcesContent":["import BlobFileReader from 'react-native/Libraries/Blob/FileReader';\nimport { Headers, RequestMethod } from './types';\nimport fromEntries from './utils/fromEntries';\n\nexport default class NetworkRequestInfo {\n  id = '';\n  type = '';\n  url = '';\n  method: RequestMethod;\n  status: number = -1;\n  dataSent = '';\n  responseContentType = '';\n  responseSize = 0;\n  requestHeaders: Headers = {};\n  responseHeaders: Headers = {};\n  response = '';\n  responseURL = '';\n  responseType = '';\n  timeout = 0;\n  closeReason = '';\n  messages = '';\n  serverClose = undefined;\n  serverError = undefined;\n  startTime: number = 0;\n  endTime: number = 0;\n\n  constructor(id: string, type: string, method: RequestMethod, url: string) {\n    this.id = id;\n    this.type = type;\n    this.method = method;\n    this.url = url;\n  }\n\n  get duration() {\n    return this.endTime - this.startTime;\n  }\n\n  get curlRequest() {\n    let headersPart =\n      this.requestHeaders &&\n      Object.entries(this.requestHeaders)\n        .map(([key, value]) => `'${key}: ${this.escapeQuotes(value)}'`)\n        .join(' -H ');\n    headersPart = headersPart ? `-H ${headersPart}` : '';\n\n    const body = this.dataSent && this.escapeQuotes(this.dataSent);\n\n    const methodPart =\n      this.method !== 'GET' ? `-X${this.method.toUpperCase()}` : '';\n    const bodyPart = body ? `-d '${body}'` : '';\n\n    const parts = ['curl', methodPart, headersPart, bodyPart, `'${this.url}'`];\n\n    return parts.filter(Boolean).join(' ');\n  }\n\n  private escapeQuotes(value: string) {\n    return value.replace?.(/'/g, `\\\\'`);\n  }\n\n  private stringifyFormat(data: any) {\n    try {\n      if (data?._parts?.length) {\n        return JSON.stringify(fromEntries(data?._parts), null, 2);\n      }\n      return JSON.stringify(JSON.parse(data), null, 2);\n    } catch (e) {\n      return `${data}`;\n    }\n  }\n\n  getRequestBody() {\n    return this.stringifyFormat(this.dataSent);\n  }\n\n  private async parseResponseBlob() {\n    const blobReader = new BlobFileReader();\n    blobReader.readAsText(this.response);\n\n    return await new Promise<string>((resolve, reject) => {\n      const handleError = () => reject(blobReader.error);\n\n      blobReader.addEventListener('load', () => {\n        resolve(blobReader.result);\n      });\n      blobReader.addEventListener('error', handleError);\n      blobReader.addEventListener('abort', handleError);\n    });\n  }\n\n  async getResponseBody() {\n    const body = await (this.responseType !== 'blob'\n      ? this.response\n      : this.parseResponseBlob());\n\n    return this.stringifyFormat(body);\n  }\n}\n"]}